;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};$(document).ready(function(){submitShow();initColumns();type=$("#type").val()?$("#type").val():0;openid=wxOpenId();getNameAndPhone();openByPv();if(!isWeiXin()){staticData()}var IS_SAVED=false;$("#submit_form").click(function(e){e.preventDefault();if(!IS_SAVED){submitData()}});$(".ec-vcard").on("click",function(){getVcard()});if("undefined"!=typeof custom){$(".formBox .form_title").css("background-color",custom.titlebg);$(".formBox").css("background-color",custom.contentbg);$(".formBox .formTit").css("color",custom.title);$(".formBox .explain").css("color",custom.title);$(".formBox").css("color",custom.content);$(".formBox .formTit").attr("class",custom.titleclass);$(".formBox .explain").attr("class",custom.descriptionclass)}if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",showImg,false)}else if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",showImg);document.attachEvent("onWeixinJSBridgeReady",showImg)}});$(window).on("load",function(){wxsilentauth();wxauth();wxbehavior()});var openid="";var silentOpenId="";var type=0;var jsapi=[];var trade_no="";var payMoney=0;function wxOpenId(){$.ajax({type:"GET",url:"https://www.workec.com/form/wxopenid",data:{formId:$("#formid").val()},async:false,dateType:"json",xhrFields:{withCredentials:true},crossDomain:true,success:function success(res){if((typeof res==="undefined"?"undefined":_typeof(res))!="object"){res=$.parseJSON(res)}if(res.ret==100){openid=res.data.openId;silentOpenId=res.data.silentOpenId}}});return openid}function getNameAndPhone(){var name=$('.submit-show[component-type="201"]');var phone=$('.submit-show[component-type="202"]');if(isWeiXin()&&(name.length||phone.length)){var params=openid||silentOpenId;$.ajax({type:"GET",url:"https://www.workec.com/default/form/info?openId="+params,data:{},async:false,dateType:"json",xhrFields:{withCredentials:true},crossDomain:true,success:function success(res){if((typeof res==="undefined"?"undefined":_typeof(res))!="object"){res=$.parseJSON(res)}if(res.ret==100){name.children("input").val(res.data.name);phone.children("input").val(res.data.mobile)}}})}}function openByPv(){$("#form_data a:not(.ec-btn, .serviceBtn, .vardBtn, #submit_form, .goto-public-btn)").on("click",function(e){var opentype=$(this).attr("data-open");if(opentype==1){e.preventDefault();var href=$(this).attr("href");var temp=href.indexOf("https:")>-1?href.replace("https://"):href.replace("http://");if(window.PVAPI&&PVAPI.hasPVFun){window.PVAPI.exec({command:504,url:href,title:"",key:window.PVAPI.getpvkey(href,temp),maxButton:"1",minButton:"1",status:"",resizeAble:"1",checkinput:"1",needLogin:"1",height:"660",width:"980",titleIcon:"201",top:"40",callback:function callback(json){console.log(json)}})}else{window.open(href)}return false}})}function getQuery(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)");var r=window.location.search.substr(1).match(reg);if(r!=null)return unescape(r[2]);return null}function staticData(){var patharr=window.location.pathname.split("/");var hname=patharr[patharr.length-1];var selfChan=getQuery("self_chan");var data={};hname=hname.substr(0,hname.length-5);data={hname:hname,id:getQuery("id"),uid:getQuery("uid"),platform:getQuery("platform"),channel:getQuery("channel"),chan:getQuery("chan"),mode:detect(),encryptuid:getQuery("encryptuid"),publicOpenid:getQuery("publicOpenid"),from:getQuery("from"),mobile:getQuery("mobile"),date:getQuery("date"),token:getQuery("token"),touid:getQuery("touid"),crmid:getQuery("crmid")};if(selfChan){data.selfChan=selfChan}$.ajax({url:"https://www.workec.com/form/static",type:"POST",dataType:"json",data:data,success:function success(res){}})}function wxauth(){if(isWeiXin()&&1==$("#isauth").val()&&!openid&&silentOpenId){$url="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxaffb31aeae5c3cb3&redirect_uri=";$redirectUri="https://www.workec.com/form/wxpayset";$redirectUri+="?purl="+encodeURIComponent(window.location.href)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirec";$url+=encodeURI($redirectUri);window.location.href=$url}}function wxsilentauth(){if(!silentOpenId&&!openid&&isWeiXin()){staticData();$url="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxaffb31aeae5c3cb3&redirect_uri=";$redirectUri="https://www.workec.com/form/silent?purl="+encodeURIComponent(window.location.href)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect";$url+=encodeURI($redirectUri);window.location.href=$url}}function wxbehaviorReport(percent){var curTime=Math.round((new Date).getTime()/1e3);var curtoken=$("#token").val();$.ajax({type:"POST",url:"https://www.workec.com/form/wxbehavior",data:{type:type,url:encodeURIComponent(window.location.href),openid:openid,clicktime:curTime,percent:percent,token:curtoken},success:function success(msg){}})}function wxbehavior(){if((1==$("#isauth").val()||2==type)&&openid&&isWeiXin()){var before=0;var a,b,c,d,e=false;if(!a){wxbehaviorReport(0);a=true}window.onscroll=function(){var after=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;if(after>before){var docHeight=$(document).height(),winTop=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,winHeight=$(window).height();var scrolled=Math.floor(winTop/(docHeight-winHeight)*100);if(scrolled>20&&scrolled<=50){if(!b){wxbehaviorReport(20);b=true}}else if(scrolled>50&&scrolled<=80){if(!c){wxbehaviorReport(50);c=true}}else if(scrolled>80&&scrolled<=95){if(!d){wxbehaviorReport(80);d=true}}else if(scrolled>95){if(!e){wxbehaviorReport(100);e=true}}}else{return false}before=after}}}function needAuth(){if(!openid){wxauth();return false}}$('#form_data input[type="text"],#form_data input[type="number"],#form_data textarea').on("focus",function(){if($("#isPay").val()==1){needAuth()}});$('#form_data input[type="checkbox"],#form_data input[type="radio"]').on("change",function(){if($("#isPay").val()==1){needAuth()}});function showImg(){$(".imgBox").on("click",function(){var imgList=[];var thisImgSrc=$(this).find("img").attr("src");for(var i=0,len=$(".imgBox").length;i<len;i++){imgList.push($($(".imgBox")[i]).find("img").attr("src"))}WeixinJSBridge.invoke("imagePreview",{current:thisImgSrc,urls:imgList})})}function jsApiCall(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:jsapi["appId"],nonceStr:jsapi["nonceStr"],package:jsapi["package"],signType:jsapi["signType"],timeStamp:jsapi["timeStamp"],paySign:jsapi["paySign"]},function(res){if(res.err_msg=="get_brand_wcpay_request:ok"){payResult()}else if(res.err_msg=="get_brand_wcpay_request:fail"){payResult()}else if(res.err_msg=="get_brand_wcpay_request:cancel"){$(".pay-model").css("visibility","inherit");$(".wx-locked .ec-modal-footer .ec-btn").css("color","#fff")}})}function callPay(){$(".pay-model").css("visibility","hidden");if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",jsApiCall,false)}else if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",jsApiCall);document.attachEvent("onWeixinJSBridgeReady",jsApiCall)}}else{jsApiCall()}}function payResult(){window.location.href="https://www.workec.com/form/wxpayresult?trade_no="+trade_no+"&purl="+encodeURIComponent(window.location.href)}function isWeiXin(){var ua=window.navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}function submitShow(){var btn='<div class="btnBox" style="display:none;" ><a href="javascript:;" id="submit_form" class="btns btn-primary">提交</a><span class="btns tipSpan" style="display:none;" id="tips"></span></div>';if(1==$("#isPay").val()){payMoney=$("input[name='pay']:checked").parents(".pay-box").find(".money").text();btn='<div class="btnBox" style="display:none;" ><a href="javascript:;" id="submit_form" class="btns btn-primary">立即支付（'+payMoney+'）</a><span class="btns tipSpan" style="display:none;" id="tips"></span></div>';$("input[name='pay']").on("click",function(){payMoney=$(this).parents(".pay-box").find(".money").text();$("#submit_form").text("立即支付（"+payMoney+"）")})}if(1<=$(".formBox .submit-show").length){$(".formBox .submit-show").last().after(btn);$(".btnBox").fadeIn()}}$("#url_qr_code").on("click",function(e){if(e.target.nodeName.id!=="qr_code_c"){$(this).hide()}});function submitData(){var isPc=/macintosh|window/.test(navigator.userAgent.toLowerCase());if(1==$("#isPay").val()&&!isWeiXin()){$("#url_qr_code").show();if($("#qr_code").has("canvas").length==0){$("#qr_code").qrcode({render:"canvas",width:240,height:240,text:window.location.href})}return false}if(1==$("#isPay").val()&&isWeiXin()&&isPc){$("#url_qr_code").show();if($("#qr_code").has("canvas").length==0){$("#qr_code").qrcode({render:"canvas",width:240,height:240,correctLevel:0,text:window.location.href})}return false}if(filterMultiSelect().length){handleErrorMultiSelect(filterMultiSelect());return false}if(isAnswerCode==1||!$(".msg-check-wrap").hasClass("hide")&&$('#form_data .block[component-type="202"] > .textInput').val()){var res=validatePhoneAndmsg();if(res===false){return false}}var form_data={};var field_arr={};var isValid=true;var hasInputField=false;$("#form_data .block").each(function(index){var component_type=$(this).attr("component-type");var field_id=$(this).attr("field-id");var key="f_"+field_id;var field_content="";var field_val="";var field_val_arr=[];var is_required=0;switch(component_type){case"103":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"104":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"105":is_required=$(this).find(".required").length;field_val=$('input[name="f_'+field_id+'"]:checked').siblings("span").html();field_val=field_val?field_val:"";if(field_val){$('input[name="f_'+field_id+'"]:checked').parents(".ec_radio").find("input").each(function(j,obj){if($('input[name="f_'+field_id+'"]:checked').get(0)==obj){field_val_arr.push(j+1+":"+field_val)}})}if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_arr[key]=field_val_arr;hasInputField=true;break;case"106":is_required=$(this).find(".required").length;$('input[name="f_'+field_id+'"]:checked').each(function(index,item){var cur_val=$(item).siblings("span").html();if(cur_val){$(item).parents(".ec_checkbox").find("input").each(function(j,obj){if(obj==item){field_val_arr.push(j+1+":"+cur_val)}})}});if(is_required&&field_val_arr.length==0){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_arr[key]=field_val_arr;hasInputField=true;break;case"201":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"202":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val().trim();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else if(field_val&&!is_mobile(field_val)){$(this).find(".lineTips").html("手机号码必须为11-13位的数字，并且以“1”或“+”开头");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"203":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"204":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"206":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else if(is_required&&(field_val.length<5||field_val.length>11)){$(this).find(".lineTips").html("QQ号码必须为5-11位的数字");isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"207":is_required=$(this).find(".required").length;field_val=$("#f_"+field_id).val();if(is_required&&field_val===""){$(this).find(".lineTips").html("这是必填项");isValid=false}else if(is_required&&!is_email(field_val)){$(this).find(".lineTips").html('邮箱只可输入数字、英文、符号，且必须包含"@"和"."');isValid=false}else{$(this).find(".lineTips").html("")}field_val_arr.push(field_val);field_arr[key]=field_val_arr;hasInputField=true;break;case"205":hasInputField=true;break}});form_data.fid=$("#formid").val();form_data.uid=getQuery("uid");form_data.encryptuid=getQuery("encryptuid");form_data.platform=getQuery("platform");form_data.channel=getQuery("channel");form_data.chan=getQuery("chan");form_data.mode=detect();form_data.publicOpenid=getQuery("publicOpenid");form_data.verifycode=$("#validateCode").val();form_data.mobile=$('#form_data .block[component-type="202"] > .textInput').val();form_data.code=$("#form_data .msg-check-wrap .textInput").val();if(isWeiXin()){var isAuth=$("#isauth").val();form_data.isauth=isAuth;form_data.openid=openid||silentOpenId;if(1==$("#isPay").val()){needAuth();form_data.payMoney=payMoney.replace(/￥/gi,"");try{form_data.payPos=$(".pay-field-container").find('input[type="radio"]:checked').parents(".pay-box").index()/2}catch(e){form_data.payPos=0}}}if("undefined"!=typeof IS_NEED_CODE&&IS_NEED_CODE&&form_data.verifycode===""){$("#tips").show().html("请填写验证码");isValid=false}else{$(".verificationCode .lineTips").html("")}form_data.content=field_arr;if(getQuery("self_chan")){form_data.selfChan=getQuery("self_chan")}if(isValid&&hasInputField){IS_SAVED=true;$.ajax({url:"https://www.workec.com/form/commit",data:form_data,type:"post",async:false,dateType:"json",xhrFields:{withCredentials:true},crossDomain:true,success:function success(res){IS_SAVED=false;if((typeof res==="undefined"?"undefined":_typeof(res))!="object"){res=$.parseJSON(res)}if(res.ret==100){$("#tips").hide();if(1==$("#isPay").val()&&res.data.jsapi){jsapi=res.data.jsapi;trade_no=res.data.trade_no;$(".pay-num").text("￥"+res.data.pay_money);$(".ec-modal-footer a").text("立即支付（￥"+res.data.pay_money+"）");$(".pay-description").text(res.data.pay_description);$(".corp-name").text(res.data.corp_name);$(".pay-model").css("visibility","inherit")}else{$(".right_box").hide();$(".vcard").hide();$(".service").hide();$("#succss_tip").show();$(".userform").css("background","#fff")}}else if(res.ret==101){generateValidateCode()}else if(res.ret==-1){getIdentifyCode();$("#validateCode").css("color","red");$("#validateCode").css("border-color","red");if(res.msg.indexOf("验证码")<0){$("#tips").show().html(res.msg)}else{handlerErrorMsg(res.msg)}}else{$("#tips").show().html(res.msg)}},error:function error(){IS_SAVED=false;$("#tips").html("服务器系统繁忙！")}})}else if(!isValid){var target;$(".lineTips").each(function(i){if($(this).text()){target=this;return false}});if(target){$(document).scrollTop($(target).offset().top-10)}}return 1}$("#back_to_form").click(function(e){getIdentifyCode();$(".right_box").show();$("#succss_tip").hide();$(".vcard").show();$(".service").show()});function getIdentifyCode(){var url="https://www.workec.com/form/createcode?__"+(new Date).getTime();$(".imgCode").attr("src",url);return false}function generateValidateCode(){if($("#validateCode").length>=1){return}var component='<div class="block verificationCode">'+'<h5 class="tit"></h5>'+'<input placeholder="请输入验证码" type="text" class="textInput" id="validateCode">'+'<img class="imgCode" onclick="getIdentifyCode();return false;" src="https://www.workec.com/form/createcode" alt=""/>'+'<div class="lineTips"></div>'+"</div>";$(component).insertBefore($("#submit_form"));$("#validateCode").keyup(function(){$(this).css("border-color","#D8D8D8");$(this).css("color","black")})}function getVcard(){var uid=getQuery("uid");if(0>=uid){uid=$("#create_uid").val()}var encryptParam=$("#corpid").val()+"|"+uid+"|"+$("#formid").val();var encrypt=encryptByDESModeECB(encryptParam);encrypt=encrypt?encrypt:vcardEncrypt;window.open("https://www.workec.com/form/vcard?encrypt="+encrypt)}function encryptByDESModeECB(message){var keyHex=CryptoJS.enc.Utf8.parse("vvFormvv");var encrypted=CryptoJS.DES.encrypt(CryptoJS.enc.Utf8.parse(message),keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return encrypted.ciphertext.toString(CryptoJS.enc.Base64)}function is_email(email){var reg=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;if(reg.test(email)){return true}else{return false}}function is_mobile(mobile){var phoneRegex=/^(\+86)?1[3|4|5|6|7|8|9][0-9]\d{8}$/;return phoneRegex.test(mobile)}function detect(){var ua=navigator.userAgent.toLowerCase();var match;var resource="";var software;if(/micromessenger(\/[\d\.]+)*/.test(ua)){resource="微信"}else if(/ec\/\d/.test(ua)){resource="EC"}else if(/qq\/\d\./.test(ua)){resource="QQ"}else if(/baidu/.test(ua)){resource="手机百度"}if(resource){return resource}match=ua.match(/WeiBo|renren|douban|facebook|UC|Chrome|Firefox|Safari|Opera|YiXin/i);software=match?match[0].toLowerCase():"";switch(software){case"weibo":resource="微博";break;case"renren":resource="人人";break;case"douban":resource="豆瓣";break;case"facebook":resource="脸书";break;case"uc":case"chrome":case"firefox":case"safari":case"opera":resource="浏览器";break;default:resource="浏览器";break}return resource}function filterMultiSelect(){var falseSelectIndex=[];$(".ec_checkbox").each(function(index){var sum=$(this).find("input[type=checkbox]:checked").length;var msg="";var condition={min:$(this).parents(".block").attr("min")>>0,max:$(this).parents(".block").attr("max")>>0};if($(this).siblings("h5").hasClass("required")){if(condition.min&&condition.max&&condition.min==condition.max&&condition.min!==sum){msg="请选择"+condition.min+"项";falseSelectIndex.push({index:index,msg:msg})}else if(condition.min&&sum<condition.min){msg="请至少选择"+condition.min+"项";falseSelectIndex.push({index:index,msg:msg})}else if(condition.max&&sum>condition.max){msg="最多选择"+condition.max+"项";falseSelectIndex.push({index:index,msg:msg})}}else{if(sum&&condition.min&&condition.max&&condition.min==condition.max&&condition.min!==sum){msg="请选择"+condition.min+"项";falseSelectIndex.push({index:index,msg:msg})}else if(sum&&condition.min&&sum<condition.min){msg="请至少选择"+condition.min+"项";falseSelectIndex.push({index:index,msg:msg})}else if(sum&&condition.max&&sum>condition.max){msg="最多选择"+condition.max+"项";falseSelectIndex.push({index:index,msg:msg})}}});return falseSelectIndex}function handleErrorMultiSelect(arr){for(var i=0,len=arr.length;i<len;i++){$(".ec_checkbox").eq(arr[i].index).parents(".block").find(".lineTips").text(arr[i].msg)}}function initColumns(){$(".ec_checkbox, .ec_radio").each(function(index){var column;if($(this).hasClass("two-columns")){column=1;$(this).find("label:nth-child(even)").after('<div class="clear"></div>')}else if($(this).hasClass("three-columns")){column=2;$(this).find("label:nth-child(3n)").after('<div class="clear"></div>')}else{column=0;$(this).find("label").remove(".clear")}})}