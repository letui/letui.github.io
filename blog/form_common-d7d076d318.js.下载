;var msgTimer=null;var ticket="";var isSendMsg=false;var msgCheckErrorMsg="";var isAnswerCode=0;$(document).ready(function(){enableFill();enableLink();isShowSms();wxshare();initMsgEvent();if("undefined"!=typeof viewType&&viewType=="preview"){reloadBtn()}});function enableFill(){$(".ec_fill").find("input").attr("disabled",false);$(".ec_fill").find("textarea").attr("disabled",false)}function enableLink(){$(".ec_link").each(function(index){var link=$(this).attr("data-link");if(link){$(this).attr("href",link)}})}function reloadBtn(){var html='<div class="reloadBtn"></div>';$("body").after(html);$(".reloadBtn").click(function(){window.location.reload()})}function isShowSms(){$.ajax({url:"https://www.workec.com/form/showsms",type:"POST",dataType:"json",data:{url:window.location.href.split("#")[0]},success:function success(res){if(res.data.isShowSms){$(".msg-check-wrap").removeClass("hide");isAnswerCode=res.data.isAnswer;isSendMsg=true;$.getScript(res.data.jsUrl,function(){msgCheckErrorMsg="请重新获取验证码"})}else{$(".msg-check-wrap").addClass("hide")}}})}function clearCcp(){capDestroy()}function showCap(){clearCcp();var capOption={callback:cbfn,showHeader:false,type:"embed"};capInit(document.getElementById("TCaptcha"),capOption);$(".captcha-wrap .captcha-masker").css("display","block");function cbfn(retJson){$(".captcha-wrap .captcha-masker").css("display","none");if(retJson.ret==0){ticket=retJson.ticket;var val=$('#form_data .block[component-type="202"] > .textInput').val();getMSgCode(val,ticket)}else{ticket=""}}}function codeVerify(mobile,code){$.ajax({url:"https://www.workec.com/form/codeverify",type:"POST",dataType:"json",async:false,data:{url:window.location.href.split("#")[0],mobile:mobile,code:code},success:function success(res){if(res.code==200){return true}else{handlerErrorMsg(res.msg);return false}}})}function wxshare(){var wxShareParam="";$.ajax({url:"https://www.workec.com/form/wexinshare",type:"POST",dataType:"json",data:{url:window.location.href.split("#")[0]},async:false,success:function success(res){wxShareParam=res.data}});wx.config({debug:false,appId:wxShareParam.appId,timestamp:wxShareParam.timestamp,nonceStr:wxShareParam.nonceStr,signature:wxShareParam.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]});wx.ready(function(){wxShareParam.url=$("<div/>").html(wxShareParam.url).text();wx.onMenuShareAppMessage({title:title,desc:desc.replace(/&nbsp;/g,"\n"),link:wxShareParam.url,imgUrl:shareImg,success:function success(){wxstatic(1)}});wx.onMenuShareTimeline({title:title,desc:desc.replace(/&nbsp;/g,"\n"),link:wxShareParam.url,imgUrl:shareImg,success:function success(){wxstatic(2)}});var shareObj={title:title,desc:desc.replace(/&nbsp;/g,"\n"),link:wxShareParam.url,imgUrl:shareImg};wx.onMenuShareQQ(shareObj);wx.onMenuShareWeibo(shareObj)})}function wxstatic(type){var patharr=window.location.pathname.split("/");var hname=patharr[patharr.length-1];var data={};var selfChan=getQuery("self_chan");hname=hname.substr(0,hname.length-5);data={type:type,hname:hname,id:getQuery("id"),uid:getQuery("uid"),platform:getQuery("platform"),channel:getQuery("channel"),chan:getQuery("chan"),mode:detect(),encryptuid:getQuery("encryptuid")};if(selfChan){data.selfChan=selfChan}$.ajax({url:"https://www.workec.com/form/wxstatic",type:"POST",dataType:"json",data:data,success:function success(res){},error:function error(err){}})}function ec_getCookie(name){var reg=new RegExp("(^| )"+name+"(?:=([^;]*))?(;|$)"),val=document.cookie.match(reg);return val?val[2]?unescape(val[2]).replace(/(^")|("$)/g,""):"":null}var ecgrow_agenttype=parseInt(ec_getCookie("ecatype"));var eclgid=ec_getCookie("eclgid");var eclgid_reg=/^[0-9]{5,}\.[0-9]{5,}$/;if(typeof ecgrow_corpid=="undefined"||typeof ecgrow_userid=="undefined"){var ecgrow_userid=0;var ecgrow_corpid=0}if(ecgrow_corpid==0&&eclgid_reg.test(eclgid)!=false){var eclgid_arr=eclgid.split(".");ecgrow_userid=eclgid_arr[0];ecgrow_corpid=eclgid_arr[1]}var ecgrow_vocation=decodeURI(decodeURI(ec_getCookie("ecvocation0")));var _vds=_vds||[];window._vds=_vds;(function(){if(ecgrow_agenttype!=1&&ecgrow_agenttype!=0){ecgrow_agenttype=1}_vds.push(["setAccountId","a4206e92c3a477e4"]);_vds.push(["setCS1","ecgrow_userid",ecgrow_userid]);_vds.push(["setCS2","ecgrow_corpid",ecgrow_corpid]);_vds.push(["setCS6","ecgrow_agenttype",ecgrow_agenttype]);_vds.push(["setCS7","ecgrow_vocation",ecgrow_vocation]);_vds.push(["setImp",false]);_vds.push(["enableHT",true]);(function(){var vds=document.createElement("script");vds.type="text/javascript";vds.async=true;vds.src=("https:"==document.location.protocol?"https://":"http://")+"dn-growing.qbox.me/vds.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(vds,s)})()})();function initMsgEvent(){$('#form_data .block[component-type="202"] > .textInput').on("keyup",function(){var msgInput=$(this).next().find(".textInput");var msgButton=$(this).next().find("button");ticket="";if($(this).next().hasClass("hide")){return}msgInput.val("");isSendMsg=true;handlerErrorMsg("");dealErrorInput();if(msgTimer){msgButton.html("获取验证码");clearInterval(msgTimer);msgTimer=null}var val=$(this).val();if(val){msgInput.removeAttr("readonly");msgButton.removeAttr("disabled").removeClass("disabled")}else{msgInput.attr("readonly","readonly");msgButton.attr("disabled","disbaled").addClass("disabled")}});$("#form_data .msg-check-wrap .textInput").on("blur",function(){msgCheckErrorMsg="";var val=$(this).val();if(!val){return}try{val=parseInt(val)}catch(error){}validatePhoneAndmsg()});$("#form_data .msg-check-wrap .textInput").on("focus",function(){handlerErrorMsg("")});$(".msg-check-wrap button").on("click",function(){if($(this).hasClass("disabled")){return}isSendMsg=false;var dom=$('#form_data .block[component-type="202"] > .textInput');var val=dom.val();if(!checkPhone(val)){handlerErrorMsg("请输入正确的中国大陆手机号");dealErrorInput(dom);return}$(this).attr("disabled","disbaled").addClass("disabled");getMSgCode(val,"")})}function dealErrorInput(dom){$("#form_data .block .error-input").removeClass("error-input");if(dom){dom.addClass("error-input")}}function handlerErrorMsg(msg){if(msg){msgCheckErrorMsg=msg}else{msgCheckErrorMsg=""}$('#form_data .block[component-type="202"] > .textInput').prev().find(".lineTips").html(msg)}function getMSgCode(phone,checked){$.ajax({url:"https://www.workec.com/form/sendcode",type:"POST",dataType:"json",data:{url:window.location.href.split("#")[0],mobile:phone,ticket:checked},success:function success(res){if(res.data&&res.data.isShowCap){showCap()}else if(res.data){handlerTimer($(".msg-check-wrap button"))}else{handlerErrorMsg(res.msg)}}})}function validatePhoneAndmsg(){var phone=$('#form_data .block[component-type="202"] > .textInput').val();var checkmsg=$(".msg-check-wrap .textInput").val();if(!checkPhone(phone)){handlerErrorMsg("请输入正确的中国大陆手机号");return false}else if(!checkmsg){handlerErrorMsg("请输入验证码");return false}else if(!/^\d+$/.test(checkmsg)||isSendMsg===true){handlerErrorMsg("请重新获取验证码");return false}else{return codeVerify(phone,checkmsg)}}function handlerTimer(dom){if(!msgTimer){var times=60;msgTimer=setInterval(function(){times--;if(times===0){clearInterval(msgTimer);msgTimer=null;dom.html("获取验证码");dom.removeAttr("disabled").removeClass("disabled")}else{dom.html("已发送（"+times+"s）");dom.attr("disabled","disbaled").addClass("disabled")}},1e3)}}function checkPhone(val){var phoneRegex=/^(\+86)?1[3|4|5|6|7|8|9][0-9]\d{8}$/;return phoneRegex.test(val)}